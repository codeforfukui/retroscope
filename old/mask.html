<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Retroscope - webkit</title>
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
<link rel="stylesheet"
	href="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script
	src="//cdn.rawgit.com/mlevans/leaflet-hash/master/leaflet-hash.js"></script>
<style>
body {
	width: 100%;
	height: 100%;
	overflow: hidden;
}

#bg, #fg {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}

#fg {
	pointer-events: none;
	-webkit-mask-image: url(mask.svg);
	-webkit-mask-repeat: no-repeat;
	-webkit-mask-position: center center;
}
</style>
</head>
<body>
	<div id="bg"></div>
	<div id="fg"></div>

	<script>
		var bg = 'http://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg';
		var fg = 'http://www.finds.jp/ws/tmc/1.0.0/Kanto_Rapid-900913-L/{z}/{x}/{y}.png';

		var master = L.map("bg", {
			zoom : 15,
			center : [ 35.670685, 139.785233 ],
			layers : [ L.tileLayer(bg, {
				maxNativeZoom : 17,
				maxZoom : 20
			}) ]
		});

		var slave = L.map("fg", {
			zoom : master.getZoom(),
			center : master.getCenter(),
			layers : [ L.tileLayer(fg, {
				maxNativeZoom : 15,
				maxZoom : 20
			}) ]
		});

		master.attributionControl.addAttribution("GSI Ortho");
		master.attributionControl.addAttribution("NIAES, NARO");
		slave.attributionControl.removeFrom(slave);
		slave.zoomControl.removeFrom(slave);
		master.zoomControl.setPosition("bottomright");

		master.on("move", function() {
			slave.setView(master.getCenter(), master.getZoom(), {
				animate : false
			})
		}).on("mousemove", function(e) {
			var p = e.containerPoint;
			var pos = (p.x - 250) + "px " + (p.y - 250) + "px";
			document.getElementById("fg").style["-webkit-mask-position"] = pos;
		});

		var hash = new L.Hash(master);
	</script>
</body>
</html>

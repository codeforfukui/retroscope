<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Retroscope</title>
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
<link rel="stylesheet"
	href="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="//cdn.rawgit.com/mlevans/leaflet-hash/master/leaflet-hash.js"></script>
<style>
body {
	width: 100%;
	height: 100%;
	overflow: hidden;
}

#map {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
</style>
</head>
<body>
	<div id="map"></div>

	<script>
		var RoundTileLayer = L.TileLayer.extend({
			onAdd : function(map) {
				L.TileLayer.prototype.onAdd.call(this, map);
				var e = this.getContainer();
				var o = this.options;
				var r = o.radius || 200;

				e.style.overflow = "hidden";
				e.style.top = "0";
				e.style.left = "0";
				e.style.width = (r * 2) + "px";
				e.style.height = (r * 2) + "px";
				e.style.borderRadius = r + "px";
				e.style.transform = "translate3d(-1000px,-1000px,0)";

				map.on("zoomend", function(event) {
					var z = map.getZoom();
					var f = (z < o.minZoom || o.maxZoom < z);
					e.style.display = (f ? "none" : "block");
				});
			},
			setCenter : function(p) {
				var e = this.getContainer();
				var r = this.options.radius || 200;
				var x = p.x - r;
				var y = p.y - r;
				e.style.transform = "translate3d(" + x + "px," + y + "px,0)";
				var t = "translate3d(" + (-x) + "px," + (-y) + "px,0)";
				for (var f = e.firstChild; f != null; f = f.nextSibling)
					if (f.style)
						f.style.transform = t;
			}
		});

		var bg = L.tileLayer(
				'http://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg', {
					attribution : "GSI Ortho",
					maxNativeZoom : 17,
					maxZoom : 20
				});

		var fg = new RoundTileLayer(
				'http://www.finds.jp/ws/tmc/1.0.0/Kanto_Rapid-900913-L/{z}/{x}/{y}.png',
				{
					attribution : "NIAES, NARO",
					maxNativeZoom : 15,
					maxZoom : 17
				});

		var map = L.map("map", {
			zoom : 15,
			center : [ 35.670685, 139.785233 ],
			layers : [ bg, fg ]
		}).on("mousemove", function(event) {
			fg.setCenter(event.layerPoint);
		});
		
		var hash = new L.Hash(map);
	</script>
</body>
</html>
